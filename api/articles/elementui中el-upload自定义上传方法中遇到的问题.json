{"title":"elementui中el-upload自定义上传方法中遇到的问题","slug":"elementui中el-upload自定义上传方法中遇到的问题","date":"2018-05-04T12:44:50.000Z","updated":"2018-05-04T12:47:44.000Z","comments":true,"path":"api/articles/elementui中el-upload自定义上传方法中遇到的问题.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<h3 id=\"由于el-upload控件中自定义的upload方法在上传文件中是以FormData的格式上传，后台服务器无法解析这种格式的body，所以通过http-request属性自定义了一个上传方法。\"><a href=\"#由于el-upload控件中自定义的upload方法在上传文件中是以FormData的格式上传，后台服务器无法解析这种格式的body，所以通过http-request属性自定义了一个上传方法。\" class=\"headerlink\" title=\"由于el-upload控件中自定义的upload方法在上传文件中是以FormData的格式上传，后台服务器无法解析这种格式的body，所以通过http-request属性自定义了一个上传方法。\"></a>由于el-upload控件中自定义的upload方法在上传文件中是以FormData的格式上传，后台服务器无法解析这种格式的body，所以通过http-request属性自定义了一个上传方法。</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">el-upload</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">class</span>=<span class=\"string\">\"upload-demo\"</span></span></span><br><span class=\"line\"><span class=\"tag\">     <span class=\"attr\">ref</span>=<span class=\"string\">\"upload\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">action</span>=<span class=\"string\">\"http://127.0.0.1:5000/json/import\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:http-request</span>=<span class=\"string\">\"myUpload\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:on-preview</span>=<span class=\"string\">\"handlePreview\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:on-remove</span>=<span class=\"string\">\"handleRemove\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:on-error</span>=<span class=\"string\">\"handleError\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:on-success</span>=<span class=\"string\">\"handleSuccess\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:file-list</span>=<span class=\"string\">\"fileList\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">:auto-upload</span>=<span class=\"string\">\"false\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">slot</span>=<span class=\"string\">\"trigger\"</span> <span class=\"attr\">size</span>=<span class=\"string\">\"small\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"primary\"</span>&gt;</span>选取文件<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left: 10px;\"</span> <span class=\"attr\">size</span>=<span class=\"string\">\"small\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"success\"</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"submitUpload\"</span>&gt;</span>上传到服务器<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">slot</span>=<span class=\"string\">\"tip\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"el-upload__tip\"</span>&gt;</span>只能上传json文件，且不超过500kb<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">el-upload</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myUpload(content) &#123;</span><br><span class=\"line\">    console.log(‘myUpload...‘);</span><br><span class=\"line\">    this.$axios(&#123;</span><br><span class=\"line\">        method: ‘post‘,</span><br><span class=\"line\">        url: content.action,</span><br><span class=\"line\">        timeout: 20000,</span><br><span class=\"line\">        data: content.file</span><br><span class=\"line\">    &#125;).then(res =&gt; &#123;</span><br><span class=\"line\">         content.onSuccess(‘配时文件上传成功‘)</span><br><span class=\"line\">    &#125;).catch(error =&gt; &#123;</span><br><span class=\"line\">        if (error.response) &#123;</span><br><span class=\"line\">             // The request was made and the server responded with a status code</span><br><span class=\"line\">             // that falls out of the range of 2xx</span><br><span class=\"line\">             content.onError(‘配时文件上传失败(‘ + error.response.status + ‘)，‘ + error.response.data);</span><br><span class=\"line\">        &#125; else if (error.request) &#123;</span><br><span class=\"line\">             // The request was made but no response was received</span><br><span class=\"line\">             // `error.request` is an instance of XMLHttpRequest in the browser and an instance of</span><br><span class=\"line\">             // http.ClientRequest in node.js</span><br><span class=\"line\">            content.onError(‘配时文件上传失败，服务器端无响应‘);</span><br><span class=\"line\">       \t&#125; else &#123;</span><br><span class=\"line\">             // Something happened in setting up the request that triggered an Error</span><br><span class=\"line\">             content.onError(‘配时文件上传失败，请求封装失败‘);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这种方式很常见，唯一要注意的点是在上传方法调用后判断结果成功或者失败的时候，需要回调el-upload控件的onSuccess和onError方法，为的是能够复用el-upload原生的一些动作，比如如果成功了，页面上的文件列表会有一个绿勾标记上传成功的文件，如果失败则会把失败的文件从文件列表中删除，如果不回调是没有这些功能的。</p>\n","categories":[],"tags":[]}